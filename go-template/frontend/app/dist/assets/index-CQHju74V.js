import{d as M,an as Q,r as u,G as H,o as m,c as p,b as a,f as i,v as r,x as d,p as g,ao as v,e as y,F as W,j as J,z as B,ap as F,aq as C,ar as z,as as O}from"./index-DykNzqLW.js";import{_ as X,A as Z}from"./extable.vue_vue_type_script_setup_true_lang-CwiyI0GK.js";import{t as w}from"./ExDate-BSXtkPeO.js";import{V as ee}from"./index-B3ZueLCo.js";import{V as te,a as le,b as T,c as ae,d as ne}from"./VCard-BMvFbdY3.js";import{V as E}from"./VAvatar-fsVdXin6.js";import{V as ie}from"./VCardText-BJnF-3QZ.js";import{d as se}from"./VList-Ct3LS8TA.js";import{V as oe}from"./VSpacer-DiqnDwL0.js";import{V as U}from"./VTextField-BYP5qumX.js";import{V as re,a as Y}from"./VRow-CRBOcwO5.js";import{V as ue}from"./VTextarea-B6XYyAjo.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VDialog-DTHIqMBw.js";import"./VOverlay-BHaGYlG-.js";import"./easing-DY7PVvcf.js";import"./transition-LHIbAFMv.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-CqAkjWGR.js";import"./VSelect-C5XjW67S.js";import"./VMenu-m666Ce8x.js";import"./VForm-DUT__qK3.js";import"./VImg-DseSWRio.js";/* empty css              */const ce={class:"posts-container"},me={class:"pa-4 bg-grey-lighten-4"},pe={key:0,class:"mb-4"},ve={class:"d-flex align-center justify-space-between"},_e={class:"d-flex align-center"},fe={class:"font-weight-medium"},ke={key:0},ye={class:"d-flex gap-2 mt-1"},Ve={key:1,class:"text-body-2"},ge={key:0,class:"d-flex gap-2"},Ce={key:1,class:"mt-3"},be={key:0,class:"d-flex gap-2"},xe={key:1},he="post/",ze=M({__name:"index",setup($e){const s=Q(),k=u(""),b=u(null),V=u(null),x=u(null),h=u(null),_=u(""),$=u([]),c=u({id:0,title:"",content:"",user_id:0,like_count:0,comment_count:0,created_at:"",likes:[],comments:[],user:{name:"",surname:""}}),P=u([{key:"content",name:""}]),R=u(new Z);c.value.user_id=s.user.id,c.value.user.name=s.user.name,c.value.user.surname=s.user.surname;const S=n=>n.some(t=>t.user_id===s.user.id),j=async(n,t)=>{const[e]=await C.post(`like/${n}`,{});e||(S(t.likes)?(t.likes=t.likes.filter(l=>l.user_id!==s.user.id),t.like_count--):(t.likes.push({user_id:s.user.id}),t.like_count++))},A=async(n,t)=>{if(console.log("Mevcut yorumlar:",t.comments),!s.isAuthenticated){z("Bu işlemi yapabilmek için giriş yapmanız gerekmektedir.");return}if(k.value.trim())try{const[e,l]=await C.post("comment",{post_id:n,content:k.value});console.log("API yanıtı:",l),e||(t.comments.push({id:l.data.id,content:k.value,post_id:n,user_id:s.user.id,user:{name:s.user.name,surname:s.user.surname}}),t.comment_count++,k.value="",b.value=null)}catch(e){console.error("Yorum hatası:",e),z("Yorum gönderilirken bir hata oluştu")}},q=n=>{V.value=n.id,_.value=n.content,x.value=n.post_id,h.value=n.user_id},L=()=>{V.value=null,x.value=null,h.value=null,_.value=""},I=async(n,t)=>{if(_.value.trim())try{const[e]=await C.put(`comment/${n}`,{id:V.value,content:_.value,post_id:x.value,user_id:h.value});if(!e){const l=t.comments.find(o=>o.id===n);l&&(l.content=_.value),V.value=null,_.value="",x.value=null,h.value=null}}catch{z("Yorum güncellenirken bir hata oluştu")}},D=async(n,t)=>{if((await O("Yorumu silmek istediğinize emin misiniz?","Sil","İptal")).isConfirmed)try{const[l]=await C.delete(`comment/${n}`);l||(t.comments=t.comments.filter(o=>o.id!==n),t.comment_count--)}catch{z("Yorum silinirken bir hata oluştu")}},G=async()=>{const[n,t]=await C.get("user");n||($.value=t.data)},K=n=>{const t=$.value.find(e=>e.id===n);return t?`${t.name} ${t.surname}`:"Bilinmeyen Kullanıcı"},N=n=>{const t=$.value.find(e=>e.id===n);return t==null?void 0:t.name[0]};return H(()=>{G()}),u([{name:"Sil",action:"delete",visible:n=>s.getRole()===10||n.user_id===s.user.id}]),(n,t)=>(m(),p("div",ce,[a(X,{form:c.value,"onUpdate:form":t[4]||(t[4]=e=>c.value=e),"api-url":he,columns:P.value,query:R.value,"create-button":"","table-actions":"","empty-table-text":"Henüz gönderi yok"},{content:i(({row:e})=>[a(te,{class:"mb-6"},{default:i(()=>[a(le,null,{prepend:i(()=>[a(E,{color:"primary",size:"40"},{default:i(()=>[r(d(N(e.user_id)),1)]),_:2},1024)]),default:i(()=>[a(T,null,{default:i(()=>[r(d(K(e.user_id)),1)]),_:2},1024),a(ae,null,{default:i(()=>[r(d(g(w)(e.created_at)),1)]),_:2},1024)]),_:2},1024),a(T,{class:"text-h10 px-4"},{default:i(()=>[r(d(e.title),1)]),_:2},1024),a(ie,{class:"text-body-1"},{default:i(()=>[r(d(e.content),1)]),_:2},1024),a(se),a(ne,null,{default:i(()=>[a(v,{variant:"text","prepend-icon":"tabler-heart",color:S(e.likes)?"error":"default",onClick:l=>j(e.id,e)},{default:i(()=>[r(d(e.like_count)+" Beğeni ",1)]),_:2},1032,["color","onClick"]),a(v,{variant:"text","prepend-icon":"tabler-message-circle",onClick:l=>b.value=b.value===e.id?null:e.id},{default:i(()=>[r(d(e.comment_count)+" Yorum ",1)]),_:2},1032,["onClick"]),a(oe)]),_:2},1024),a(ee,null,{default:i(()=>[y("div",me,[e.comments.length?(m(),p("div",pe,[(m(!0),p(W,null,J(e.comments,l=>(m(),p("div",{key:l.id,class:"mb-3"},[y("div",ve,[y("div",_e,[a(E,{color:"primary",size:"32",class:"me-2"},{default:i(()=>[r(d(N(l.user_id)),1)]),_:2},1024),y("div",null,[y("div",fe,d(K(l.user_id)),1),V.value===l.id?(m(),p("div",ke,[a(U,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),density:"compact",variant:"outlined",rules:[o=>!!o||"Yorum boş olamaz"],onKeyup:F(o=>I(l.id,e),["enter"])},null,8,["modelValue","rules","onKeyup"]),y("div",ye,[a(v,{size:"small",color:"primary",onClick:o=>I(l.id,e)},{default:i(()=>[r(" Kaydet ")]),_:2},1032,["onClick"]),a(v,{size:"small",variant:"outlined",onClick:L},{default:i(()=>[r(" İptal ")]),_:1})])])):(m(),p("div",Ve,d(l.content),1))])]),l.user_id===g(s).user.id||g(s).getRole()===10?(m(),p("div",ge,[a(v,{icon:"tabler-edit",size:"x-small",variant:"text",onClick:o=>q(l)},null,8,["onClick"]),a(v,{icon:"tabler-trash",size:"x-small",variant:"text",color:"error",onClick:o=>D(l.id,e)},null,8,["onClick"])])):B("",!0)])]))),128))])):B("",!0),b.value===e.id?(m(),p("div",Ce,[a(U,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=l=>k.value=l),label:"Yorum yaz...",rules:[l=>!!l||"Yorum boş olamaz"],"append-inner-icon":"tabler-send","onClick:appendInner":l=>A(e.id,e),onKeyup:F(l=>A(e.id,e),["enter"])},null,8,["modelValue","rules","onClick:appendInner","onKeyup"])])):B("",!0)])]),_:2},1024)]),_:2},1024)]),modalBody:i(({closemodal:e,formloading:l,iscreateform:o})=>[o||g(s).getRole()===10||c.value.user_id===g(s).user.id?(m(),p("div",be,[a(re,null,{default:i(()=>[a(Y,{cols:"12"},{default:i(()=>[a(U,{modelValue:c.value.title,"onUpdate:modelValue":t[2]||(t[2]=f=>c.value.title=f),label:"Başlık",rules:[f=>!!f||"Başlık zorunludur"]},null,8,["modelValue","rules"])]),_:1}),a(Y,{cols:"12"},{default:i(()=>[a(ue,{modelValue:c.value.content,"onUpdate:modelValue":t[3]||(t[3]=f=>c.value.content=f),label:"Ne düşünüyorsun?",rows:"4",counter:"",rules:[f=>!!f||"İçerik zorunludur"]},null,8,["modelValue","rules"])]),_:1}),a(Y,{cols:"12",class:"d-flex justify-end gap-4"},{default:i(()=>[a(v,{type:"submit",loading:l,color:"primary"},{default:i(()=>[r(d(o?"Paylaş":"Güncelle"),1)]),_:2},1032,["loading"]),a(v,{variant:"tonal",loading:l,onClick:e},{default:i(()=>[r(" Vazgeç ")]),_:2},1032,["loading","onClick"])]),_:2},1024)]),_:2},1024)])):(m(),p("div",xe,[r(" Bu gönderiyi düzenleme yetkiniz yok. "),a(v,{variant:"tonal",loading:l,onClick:e},{default:i(()=>[r(" Vazgeç ")]),_:2},1032,["loading","onClick"])]))]),_:1},8,["form","columns","query"])]))}}),Xe=de(ze,[["__scopeId","data-v-68b18dbc"]]);export{Xe as default};
